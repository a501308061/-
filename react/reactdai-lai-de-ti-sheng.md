# 为什么是React

## 前端框架发展史

在很久很久以前，前端的框架是被一个小小的$符号支配。

因为各个浏览器厂商提供的js解析器不一样，导致编写JS异常的困难。不同的浏览器就有不同的实现标准。

最特殊的要数IE，因为当年IE的份额最大，几乎是只手遮天。但是他提供的js解析却又很辣鸡。

于是呢，就有一群人为了提升开发体验建立了一个用于Dom操作的库，称之为jQuery。通过这个库，可以在不同浏览器里面自由的操作Dom元素，同时，也为其他库提供了拓展方法。所以，在2008年的时候，风靡全球。

自2013年以来，Facebook对现有的框架都不满意，决定自己开发一套框架。而没多久，也诞生了今天非常火的网页框架Vue。

## jQuery库存在的几个问题

类jQuery的框架被统称为旧版。我的公司在移动端，采用的框架是Backbone+Zepto，官网采用的是Dot+jQuery。

### 举个例子

![](/assets/import.png)

上述是一个简易版的微博。我们分析一下使用类jQuery的框架需要怎么编写。首先我们要切分组件。

1. 左边的个人模块，会记录发了多少条微博，以及新鲜事
2. 发送上面白色的一块是一个富文本编辑器
3. 蓝色的一块是最新的微博

那么我们分析一下，点击一个发送要怎么办。

发送成功，首先棕色的部分要自动响应，把微博数量+1，同时刷新新鲜事。下面的微博要把自己的一条置顶，然后请求后台接口刷新当前的微博状态。发送按钮要请求后台接口，然后把富文本的内容清零。如果发送失败，只保留富文本，其余不变。

首先，发送调用ajax，肯定是写在发送的按钮的逻辑里面。但是下来就麻烦了。因为划分了组件，发送键是不应该伸手直接用$\(\#xxx\)去别的组件改变别的状态，这样的耦合重，发生问题不容易在组件中排查。

那怎么搞？于是呢，每个组件里面就要定义一系列的事件去接受其他组件派发过来的事件，然后自我更新。

从事件的维度上看，这种方式仍然是不合理的，因为写一个事件需要跨越多个文件。有时候页面复杂而组件划分精细的情况下，一个事件需要8-9个组件协调工作，这个时候写的人是相当痛苦的。

### 其他更好的方式

其实，我们上述的操作，事件和视图之前相互操作是相当混乱的。事件改变视图、视图触发事件。

更优的情况是，视图根据仅根据数据改变，而事件改变数据。这样子，事件只集中进行ajax等数据交互，视图只关系什么样的数据渲染什么样的内容。

但是这个还有问题。最大的问题就是html，html作为一种标记语言，本身是不具备逻辑运算功能的。如何根据不同的数据产生不同的内容，归根结底还是要js来操作。

所以，React、Vue、Ng等具有双向绑定的框架就横空出世了。事件改变数据这个我们暂时不说，但是视图根据数据渲染就是React等现代框架给我们带来的惊喜。

### React

react在开发上最大的体验就是可以填入变量

```jsx
<div>{x}</div>
```

那这个样子和dot等模板的渲染有什么不同呢？  
在dot等传统模板中只能在渲染页面的时候填入数据，而不能渲染后填入数据。（要渲染后填入怎么办？那就再渲染一次或者使用$进行dom操作）  
通过引入在页面中绑定的变量，使得我们在处理action的关注点在于数据而不在视图。

### 回到我们的例子

假设我们现在已经有了React这样的神器，我们的这个页面要怎么写呢？  
首先，定义一个全局的变量接受各种各样的数据。  
然后，所有的组件都按照这个思路进行设计  
1. 新鲜事的icon只受标签isNew的影响。
2. 个人发的微博数目也只受weiboNum的影响。
3. 下面的微博详情受一个数组weiboArr的影响。

页面的事件可以这样设计：
1. 点击发送的时候，同时更新weiboNum，请求数据，刷新weiboArr，并将自己发的这条push到这个数组里面。
2. 定时任务刷新isNew，若点击刷新，则请求数据，更改 weiboArr

这个页面就完成了。这样无论从视图层还是从事件层中都相当分明，也易于排查故障。
1. 出问题的时候首先检查接口，如若接口返回不对，就可以怼后端了。
2. 当数据返回正确，首先确保数据是进入了全局的变量。如果未进，则检查接口返回的回调函数。
3. 若进入全局变量，则检查页面的逻辑，将出错的组件自身以及其父级组件检查。
这样开发和调试有序进行，页面逻辑简明、规范。

