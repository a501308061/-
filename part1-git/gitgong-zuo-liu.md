# git的工作流

## 关于master

git创建之后就会让你初始化项目，一般我习惯上就会新建一个readme的文档。

![](/assets/深度截图_选择区域_20181018151652.png)  

（图1 创建库）  

![](/assets/深度截图_选择区域_20181018151753.png) 
 
![](/assets/深度截图_选择区域_20181018151839.png)  

（新建readme）  

![](/assets/深度截图_选择区域_20181018151839.png)  

（创建之后）  

看到创建之后的没有？git在创建仓库之后会直接帮你塞入master分支。

## master分支

master意味着是大师的意思。所以一般人除了问题都习惯上去问“大师”的。也就意味着一个人访问你的仓库，他会优先的拉去master分之的代码。  
一般的小菜鸡，要成为master要经历一番磨炼。  
要经历过什么样的磨炼呢？  
一般的人写代码，只有develop的水平，经过内部测试（或者自动化测试）之后，就会进入release分支，这个时候一般就会以release进行发包。经过无数人的试验确实ok的时候，就会被合并进入master分支。

## 听起来好像好简单的样子

实际上我们的工作环境是远远复杂于这种理想的状态的。  
例如，我们的h5同事一共有20多名。如果每个人都在develop分支上开发的话会有很多的冲突发生。  
尤其是在项目比较大型，公共的方法文件、组件库等会发生冲突。  
这样你改一下提交，有冲突，我改一下，有冲突。解决冲突的时间会比较长，开发效率低下。  
那么什么才是合适的方式呢？应该git上会给你一个分支，你自己随便搞是你的事情，搞完了，测试通过了，咱们再合进来主要develop分支。  
所以我们又诞生了一个名词——功能分支,我们使用func分支来代替他们。

## 再理一下

func1、func2--&gt;develop--&gt;release--&gt;master  
以上就是我们的工作流

## 你以为这就没问题了？

对于app来说，这个当然没有问题了。因为每个人提交测试的时候可以拿自己的功能分支打包提交给测试测。  
但是我们是h5，由于测试是需要域名的。我们的测试服务器不可能给每一个h5的同事分配一个独立的测试环境。  
所以，功能分支虽好，但是不能提交测试，只能自测。而直接提交至develop又是不靠谱的方案。

## 折中的方案

人总是要灵活变通的，既然环境不能改变就改变自己嘛。打不过他们就加入他们拉低他们的战斗力嘛。  
这个时候，就需要有多个develop分支了。因为20多个人总有某些维度可以划分成不同的群体。例如关于XX处的功能提交到这个develop分支，关于另一个处室提过来的需求合到另一个develop分支。这个时候，我们可能只有5个处室，几个人公用一个环境，那么建造五个环境就行了。（五个我们服务器还承受得来）

## 在总结一下我们的工作流

func分支1--&gt;develop分支1--&gt;release--&gt;..  
func分支2--&gt;develop分支2--&gt;release--&gt;..  
func分支3--&gt;develop分支1--&gt;release--&gt;..

## 别急

事情总是没有那么简单的，虽然已经经过这么多波折了。  
在软件研发上，天天都有新鲜事。例如，这个版本的没有上线，下个版本的就要开始开发了。更有甚者，会出现上线前最后一天已经合并进入release分支，突然通知某几个功能由于XXXX原因不能闪现了。  
我的内心OS：  
![](/assets/深度截图_选择区域_20181018160907.png)  
emmm，进入到这个地步，git就很难设计了。

## 希望总是有的

为了应对这个~~（操蛋）~~的情况，只能在develop分支上动手脚。  
~~（你tm）~~总不可能三个版本的一起开发吧，我develop分支从五个一下变成10个，每个独立组的develop给你分3环境，然后release也给你×2，这样总可以了吧。  
对于要回撤的功能，则重新建立develop分支，上线清单中的内容在功能分支里面一个个推进去。不允许直接在develop分支上进行操作。

## 最终的工作流

func分支n个  
develop分支10个  
release分支2个  
master分支1个  
func分支合并进入develop分支进行测试，测试通过并准备发包时合并进入release分支。稳定和后合并进入master分支。  
新的功能以master分支为蓝本，进行开发。功能分支需要连续多个版本上线的则自行merge master分支进行状态提升。

