# 多服务器之间的通信
其实这一节主要是讲ssh的  
每次服务器故障都只会找我.....所以我觉得把他们的原理讲清楚。
然后不用每次故障都孤独弱小又可怜的我.....
## IDE
Windows下推荐使用Xshell.
Linux下面推荐使用Remmina
## Windows的远程
### Windows系统
点击开始-搜索-远程连接工具  
这里我就不多说了
### Linux系统
Linux下远程也是比较简单的。
Remmina有一个协议叫做RDP，这个就是Windows远程桌面连接的协议。
但是需要注意的是Remmina虽然支持多种协议，但是大而不精。
导致RDP协议无法复制文件....
此外，RDP协议默认同一个主机（用户）不能多人用。

##　Linux系统的远程
说实话，远程还是Linux的天下。
Linux中最常用的协议当然就是SSH。像我所处的公司是比较严格的，SSH默认的22端口，生产服务器是不允许使用办公环境直连的，必须要到机房去才能登录生产服务器。
当然人总是不能那么死板的，因为生产的服务器80、443、8080等http协议的端口总是要开放给办公网络使用的。
所以经常就有人~~偷偷的~~开通了某个小端口到办公环境的网络关系，并且在那里开启ssh协议。这样普通环境下就能登录生产环境了。  
更进一步，开了一台之后你要登录另一台生产服务器那也就可以ssh上去了。
也即ssh 172.X.X.X -p 6666 之后进入命令行，然后再输入 ssh 172.88.88.88 进入你想要的服务器。
但是有些服务器，我们要跳三台甚至五台才能进去。这样就超级麻烦了。
因此，Xshell和Remmina都有这样的命令  

![](/assets/深度截图_选择区域_20181019161027.png)

协助你一口气输入你的命令到达目的地。
当然这里就需要借助expect的语法
```bash
#!/usr/bin/expect
# auto ssh
  set login_name "root"
  set login_host "XXXXX"
  set login_term "XXXX"
  spawn  ssh $login_name@$login_host

  expect "*password:"

  #这里的"\r"就不用多解释了吧
  send "wodemima\r"
  expect "Last login:"
  send "ssh -p 6666 $login_term\r"
  interact
```
expect的语法就是等待和应答。因为登录某一台服务器的时候都会冒出一句"Last login"所以依据这个就能写出自动登录的脚本。
而Xshell中已经集成了这样的功能。（所以你让你的同事拷一份给你就好了）
### 其他的认证方式
除了我们这种输入账号密码的，linux之间的ssh还有很多花样。

#### 公钥认证
公钥就相当于一个服务器的身份证。那首先呢，我们可以给自己签发身份证的。
```
ssh-keygen -t rsa
```
这样就能给自己的主机签发身份证了。当然这里还可以输入一些参数（如相位等），如果你只是想做个免密码登录那就一路回车就行了。

不过我劝你还是先确定你操作的主机没有公钥。因为很有可能其他人已经生成过了。如果他们的参数和你的不一致，就会导致本机做过的其他免登全部失效。
```
cd ~/.ssh/
ls
```
这里的id_rsa.pub就是公钥了。
然后我们就要把id_rsa里面的内容推入目标机器的~/.ssh/authorized_keys里面
这里也有命令
```
ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.1.100

```